<table class="images-list">
  <thead>
    <tr>
      <th>Preview</th>
      <th>Size</th>
    </tr>
  </thead>
  <tbody>
    $each{ file in files }
    <tr class="_row $if{ /white|light/.test(file.path) }_bg-dark{/}">
        <td class="_img">
          <a href="${ cwd + '/' + file.path }" target="_blank">
            <img src="${ cwd + '/' + file.path }"/>
          </a>
        </td>
        <td class="_dimensions">
          <pre><code>width: ${ file.dimensions.width }px
height: ${ file.dimensions.height }px</code></pre>
        </td>
    </tr>
    <tr>
      <td class="_link" colspan="2">
        <input type="text" value="${ file.fullpath }"></input>
        <div class="-copied-text">copied!</div>
        <button>‚éò</button>
      </td>
    </tr>
    {/}
  </tbody>
  </table>

  <script>
    [].forEach.call(document.querySelectorAll('td._link'), function (td_el) {
      var input_el = td_el.querySelector('input')
      var button_el = td_el.querySelector('button')

      function _onSuccess () {
        td_el.className = '_link _copied-ok'
        button_el.textContent = 'üëç'
        setTimeout(function () {
          td_el.className = '_link'
          button_el.textContent = '‚éò'
        }, 1600)
      }

      function _clipboardFallback () {
        button_el.addEventListener('click', function () {
          input_el.select()
          var success = document.execCommand("copy")
          if( success ) _onSuccess()
        })
      }

      if( window.Clipboard ) {
        navigator.permissions.query({name: "clipboard-write"}).then(function() {
          new Clipboard(button_el, {
            target: function() {
              console.log('Clipboard target', input_el)
              return input_el
            }
          }).on('success', _onSuccess)
        }, _clipboardFallback)
      } else {
        _clipboardFallback()
      }

      
    })
  </script>
